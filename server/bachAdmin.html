<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Panel de administración</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="css/admin.css">
</head>
<body>
  <div class="container text-center">
    <h1>Panel de administración</h1>
    <h3>Bachillerato</h3>

    <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
      <li class="nav-item pill">
        <a class="nav-link active" id="pills-controles-tab" data-toggle="pill" href="#pills-controles" role="tab" aria-controls="pills-home" aria-selected="true">Controles</a>
      </li>
      <li class="nav-item pill">
        <a class="nav-link" id="pills-estado-tab" data-toggle="pill" href="#pills-estado" role="tab" aria-controls="pills-profile" aria-selected="false">Estado del concurso</a>
      </li>
    </ul>

    <div class="tab-content" id="pills-tabContent">
      <div class="tab-pane fade show active" id="pills-controles" role="tabpanel" aria-labelledby="pills-home-tab">
        <div class="container-fluid">
          <div class="row" style="padding: 10px;">
            <div class="col-md-12">
              <div class="page-header text-center">
                <h2>
                  Controles
                </h2>
              </div>
              <div class="row text-center" style="padding: 10px;">
                <div class="col-md-4 col-sm-12">
                  <div class="jumbotron m-1">
                    <h3>
                      Sonidos
                    </h3>
                    <div class="row" style="padding: 10px;">
                      <div class="col-md-2 col-sm-2" style="margin: auto;">
                        <button id="correct" type="button" class="btn btn-light">
                          <i class="fas fa-check-circle"></i>
                        </button>
                      </div>
                    </div>
                    <div class="row" style="padding: 10px;">
                      <div class="col-md-2 col-sm-2" style="margin: auto;">
                        <button id="incorrect" type="button" class="btn btn-light">
                          <i class="fas fa-times-circle"></i>
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-8 col-sm-12">
                  <div class="jumbotron m-1">
                    <h3>
                      Preguntas
                    </h3>
                    <div class="row controls">
                      <button id="previous" type="button" class="btn btn-light">
                        <i class="fas fa-backward"></i><span> Anterior</span>
                      </button>

                      <button id="play" type="button" class="btn btn-light">
                        <i class="fas fa-pause"></i><span> Pausar</span>
                      </button>

                      <button id="next" type="button" class="btn btn-light">
                        <i class="fas fa-forward"></i><span> Siguiente</span>
                      </button>
                    </div>

                    <div class="row timers">
                      <button id="timer" type="button" class="btn btn-light">
                        <i class="fas fa-stopwatch"></i><span> 16”</span>
                      </button>
                    </div>

                    <div class="row types">
                      <button id="oneInFour" type="button" class="btn btn-light">
                        <i class="fas fa-ellipsis-v"></i><span> Una entre cuatro</span>
                      </button>

                      <button id="oneInThree" type="button" class="btn btn-light">
                        <i class="fas fa-ellipsis-v"></i><span> Una entre tres</span>
                      </button>
                    </div>

                    <div id="fourOptions">
                      <div class="row options">
                        <button id="option1in4" type="button" class="btn btn-light">
                          Opción 1
                        </button>

                        <button id="option2in4" type="button" class="btn btn-light">
                          Opción 2
                        </button>
                      </div>
                      <div class="row options">
                        <button id="option3in4" type="button" class="btn btn-light">
                          Opción 3
                        </button>

                        <button id="option4in4" type="button" class="btn btn-light">
                          Opción 4
                        </button>
                      </div>
                    </div>

                    <div id="threeOptions">
                      <div class="row controls">
                        <button id="option1in3" type="button" class="btn btn-light">
                          Opción 1
                        </button>

                        <button id="option2in3" type="button" class="btn btn-light">
                          Opción 2
                        </button>

                        <button id="option3in3" type="button" class="btn btn-light">
                          Opción 3
                        </button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col-md-12 col-sm-12">
                  <div class="jumbotron m-1">
                    <h3>
                      Marcadores
                    </h3>
                    <div class="row pushbuttons">
                      <button id="lock" type="button" class="btn btn-light">
                        <i class="fas fa-lock-open"></i><span> Bloquear pulsadores</span>
                      </button>
                    </div>
                    <div class="row pushbuttons">
                      <div class="col-md-4 col-sm-12">
                        <h4>
                          Marcador A
                        </h4>
                        <div class="row" style="padding: 10px;">
                          <div class="col-md-2 col-sm-2" style="margin: auto;">
                            <button id="addA" type="button" class="btn btn-light">
                              <i class="fas fa-plus"></i>
                            </button>
                          </div>
                        </div>
                        <div class="row" style="padding: 10px;">
                          <div class="col-md-2 col-sm-2" style="margin: auto;">
                            <button id="substractA" type="button" class="btn btn-light">
                              <i class="fas fa-minus"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                      <div class="col-md-4 col-sm-12">
                        <h4>
                          Marcador B
                        </h4>
                        <div class="row" style="padding: 10px;">
                          <div class="col-md-2 col-sm-2" style="margin: auto;">
                            <button id="addB" type="button" class="btn btn-light">
                              <i class="fas fa-plus"></i>
                            </button>
                          </div>
                        </div>
                        <div class="row" style="padding: 10px;">
                          <div class="col-md-2 col-sm-2" style="margin: auto;">
                            <button id="substractB" type="button" class="btn btn-light">
                              <i class="fas fa-minus"></i>
                            </button>
                          </div>
                        </div>

                      </div>
                      <div class="col-md-4 col-sm-12">
                        <h4>
                          Marcador C
                        </h4>
                        <div class="row" style="padding: 10px;">
                          <div class="col-md-2 col-sm-2" style="margin: auto;">
                            <button id="addC" type="button" class="btn btn-light">
                              <i class="fas fa-plus"></i>
                            </button>
                          </div>
                        </div>
                        <div class="row" style="padding: 10px;">
                          <div class="col-md-2 col-sm-2" style="margin: auto;">
                            <button id="substractC" type="button" class="btn btn-light">
                              <i class="fas fa-minus"></i>
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="tab-pane fade" id="pills-estado" role="tabpanel" aria-labelledby="pills-profile-tab">
        <div class="container-fluid">
          <div class="row" style="padding: 10px;">
            <div class="col-md-12">
              <div class="page-header text-center">
                <h2>
                  Estado del concurso
                </h2>
              </div>
              <div class="row" style="padding: 10px;">
                <div class="col-md-12 col-sm-12">
                  <div class="jumbotron m-1">
                    <ul style="text-align: left;">
                      <li class="list-item">
                        Pregunta: <strong id="question"></strong>
                      </li>
                      <li class="list-item">
                        Tiempo restante: <strong id="timeleft"></strong>
                      </li>
                      <li class="list-item">
                        Turnos: <strong id="turn1"></strong><strong id="turn2"></strong>
                      </li>
                      <li class="list-item">
                        Opción seleccionada: <strong id="option"></strong>
                      </li>
                      <li class="list-item">
                        Equipo A: <strong id="teamA"></strong>
                      </li>
                      <li class="list-item">
                        Equipo B: <strong id="teamB"></strong>
                      </li>
                      <li class="list-item">
                        Equipo C: <strong id="teamC"></strong>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script>
    var width;
    var playing = "true";
    var locked = "false";

    $(document).ready(function () {
      runPoll();
    });

    function runPoll() {
      setTimeout(function () {
        $.ajax({
          url: 'http://olistreaming.ddns.net:8888/server/bachServer.php',
          success: function (response) {
            playing = response[0].value;
            locked = response[8].value;
            updateState(response);
          },
          dataType:"json",
          complete: function () {
            runPoll();
          }
        })
      }, 100);
    };

    function autoPause(timeout) {
      width = $(window).width();

      setTimeout(function() {
        $.post("bachServer.php", { play: false });
        if(width < 575.98) {
          play.innerHTML = '<i class="fas fa-play"></i>';
        } else {
          play.innerHTML = '<i class="fas fa-play"></i><span> Reproducir</span>';
        }
      }, timeout);
    }

    play.onclick = function() {
      width = $(window).width();

      if(width < 575.98) {
        if(playing == "false") {
          $.post("bachServer.php", { play: true });
          play.innerHTML = '<i class="fas fa-pause"></i>';
        } else {
          $.post("bachServer.php", { play: false });
          play.innerHTML = '<i class="fas fa-play"></i>';
        }
      } else {
        if(playing == "false") {
          $.post("bachServer.php", { play: true });
          play.innerHTML = '<i class="fas fa-pause"></i><span> Pausar</span>';
        } else {
          $.post("bachServer.php", { play: false });
          play.innerHTML = '<i class="fas fa-play"></i><span> Reproducir</span>';
        }
      }
    };

    previous.onclick = function() {
      width = $(window).width();

      $.post("bachServer.php", { previous: true, play: true});
      if(width < 575.98) {
        play.innerHTML = '<i class="fas fa-pause"></i>';
      } else {
        play.innerHTML = '<i class="fas fa-pause"></i><span> Pausar</span>';
      }
    };

    next.onclick = function() {
      width = $(window).width();

      $.post("bachServer.php", { next: true, play: true });
      if(width < 575.98) {
        play.innerHTML = '<i class="fas fa-pause"></i>';
      } else {
        play.innerHTML = '<i class="fas fa-pause"></i><span> Pausar</span>';
      }
    };

    timer.onclick = function() {
      time = 17;
      timeout();
    }

    function timeout() {
      if(time >= 0) {
        time -= 1;
        $.post("bachServer.php", { timer: time });
        setTimeout("timeout()", 1000);
      } else {
        return
      }
    }

    oneInFour.onclick = function() {
      if (fourOptions.style.display == "none") {
        threeOptions.style.display = "none";
        fourOptions.style.display = "block";
      } else {
        threeOptions.style.display = "none";
        fourOptions.style.display = "none";
      }
    }

    oneInThree.onclick = function() {
      if (threeOptions.style.display == "none") {
        fourOptions.style.display = "none";
        threeOptions.style.display = "block";
      } else {
        fourOptions.style.display = "none";
        threeOptions.style.display = "none";
      }
    }

    option1in4.onclick = function() {
      $.post("bachServer.php", { option1in4: true });
    };

    option2in4.onclick = function() {
      $.post("bachServer.php", { option2in4: true });
    };

    option3in4.onclick = function() {
      $.post("bachServer.php", { option3in4: true });
    };

    option4in4.onclick = function() {
      $.post("bachServer.php", { option4in4: true });
    };

    option1in3.onclick = function() {
      $.post("bachServer.php", { option1in3: true });
    };

    option2in3.onclick = function() {
      $.post("bachServer.php", { option2in3: true });
    };

    option3in3.onclick = function() {
      $.post("bachServer.php", { option3in3: true });
    };

    correct.onclick = function() {
      $.post("bachServer.php", { sfx: 0 });
    };

    incorrect.onclick = function() {
      $.post("bachServer.php", { sfx: 1 });
    };

    lock.onclick = function() {
      width = $(window).width();

      if(width < 575.98) {
        if(locked == "false") {
          $.post("bachServer.php", { lock: true });
          lock.innerHTML = '<i class="fas fa-lock"></i>';
        } else {
          $.post("bachServer.php", { lock: false });
          lock.innerHTML = '<i class="fas fa-lock-open"></i>';
        }
      } else {
        if(locked == "false") {
          $.post("bachServer.php", { lock: true });
          lock.innerHTML = '<i class="fas fa-lock"></i><span> Desloquear pulsadores</span>';
        } else {
          $.post("bachServer.php", { lock: false });
          lock.innerHTML = '<i class="fas fa-lock-open"></i><span> Bloquear pulsadores</span>';
        }
      }
    }

    addA.onclick = function() {
      $.post("bachServer.php", { addA: true });
    };

    substractA.onclick = function() {
      $.post("bachServer.php", { substractA: true });
    };

    addB.onclick = function() {
      $.post("bachServer.php", { addB: true });
    };

    substractB.onclick = function() {
      $.post("bachServer.php", { substractB: true });
    };

    addC.onclick = function() {
      $.post("bachServer.php", { addC: true });
    };

    substractC.onclick = function() {
      $.post("bachServer.php", { substractC: true });
    };

    function updateState(response) {
      width = $(window).width();
      if(width < 575.98) {
        if(playing == "false") {
          play.innerHTML = '<i class="fas fa-pause"></i>';
        } else {
          play.innerHTML = '<i class="fas fa-play"></i>';
        }
      } else {
        if(playing == "false") {
          play.innerHTML = '<i class="fas fa-pause"></i><span> Pausar</span>';
        } else {
          play.innerHTML = '<i class="fas fa-play"></i><span> Reproducir</span>';
        }
      }
      question.innerHTML = response[1].value;
      if (response[2].value == 13 || response[2].value == 14) {
        option.innerHTML = 1;
      } else if (response[2].value == 23 || response[2].value == 24) {
        option.innerHTML = 2;
      } else if (response[2].value == 33 || response[2].value == 34) {
        option.innerHTML = 3;
      } else if (response[2].value == 44) {
        option.innerHTML = 4;
      } else {
        option.innerHTML = "ninguna";
      }
      teamA.innerHTML = response[3].value;
      teamB.innerHTML = response[4].value;
      teamC.innerHTML = response[5].value;
      if(response[6].value > 0) {
        timeleft.innerHTML = response[6].value;
      } else {
        timeleft.innerHTML = 0;
      }
      if(response[7].value[0] == "a") {
        turn1.innerHTML = "Equipo A primero";
      } else if (response[7].value[0] == "b") {
        turn1.innerHTML = "Equipo B primero";
      } else if (response[7].value[0] == "c") {
        turn1.innerHTML = "Equipo C primero";
      } else {
        turn1.innerHTML = "ninguno";
      }
      if(response[7].value[1] == "a") {
        turn2.innerHTML = ", Equipo A después";
      } else if (response[7].value[1] == "b") {
        turn2.innerHTML = ", Equipo B después";
      } else if (response[7].value[1] == "c") {
        turn2.innerHTML = ", Equipo C después";
      } else {
        turn2.innerHTML = "";
      }
      if(width < 575.98) {
        if(locked == "false") {
          lock.innerHTML = '<i class="fas fa-lock"></i>';
        } else {
          lock.innerHTML = '<i class="fas fa-lock-open"></i>';
        }
      } else {
        if(locked == "false") {
          lock.innerHTML = '<i class="fas fa-lock"></i><span> Desloquear pulsadores</span>';
        } else {
          lock.innerHTML = '<i class="fas fa-lock-open"></i><span> Bloquear pulsadores</span>';
        }
      }
    }
    </script>
  </body>
  </html>
