<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Streaming</title>
  <link rel="stylesheet" href="css/streaming.css">
</head>
<body>
  <img id="correct1" src="media/correcta12.svg"></img>
  <img id="correct2" src="media/correcta12.svg"></img>
  <img id="correct3" src="media/correcta34.svg"></img>
  <img id="correct4" src="media/correcta34.svg"></img>
  <div class="fullscreen-bg">
    <video id="player1" src="media/video1.mp4" autoplay loop muted></video>
    <video id="player2" src="media/video1.mp4" autoplay loop muted></video>
  </div>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script>
    var correct1 = document.getElementById("correct1");
    var correct2 = document.getElementById("correct2");
    var correct3 = document.getElementById("correct3");
    var correct4 = document.getElementById("correct4");
    var player1 = document.getElementById("player1");
    var player2 = document.getElementById("player2");
    var video = 1;
    var option = 0;

    $(document).ready(function () {
      runPoll();
    });

    function runPoll() {
      setTimeout(function () {
        $.ajax({
          url: 'http://olistreaming.ddns.net:8888/server/cyclServer.php',
          success: function (response) {
            checkPlay(response[0]);
            if(video != response[1].value) {
              changeVideo(response);
            }
            if(option != response[2].value) {
              changeOption(response);
            }
          },
          dataType: "json",
          complete: function () {
            runPoll();
          }
        })
      }, 100);
    };

    function checkPlay(response) {
      if(player1.style.display != "none") {
        if(response.value == "true") {
          if(player1.paused) {
            player1.play();
          }
        } else if(response.value == "false"){
          if(!player1.paused) {
            player1.pause();
          }
        }
      } else if(player2.style.display != "none") {
        if(response.value == "true") {
          if(player2.paused) {
            player2.play();
          }
        } else if(response.value == "false"){
          if(!player2.paused) {
            player2.pause();
          }
        }
      }
    }

    function changeVideo(response) {
      video = response[1].value;
      if(video % 2 == 0) {
        player1.src = "media/video" + response[1].value + ".mp4";
        setTimeout(function() {
          player2.style.display = "none";
          player1.style.display = "block";
        }, 500);
      } else {
        player2.src = "media/video" + response[1].value + ".mp4";
        setTimeout(function() {
          player1.style.display = "none";
          player2.style.display = "block";
        }, 500);
      }
    }

    function changeOption(response) {
      option = response[2].value;
      if(option == 0) {
        correct1.style.display = "none";
        correct2.style.display = "none";
        correct3.style.display = "none";
        correct4.style.display = "none";
      } else if(option == 1) {
        correct1.style.display = "block";
        correct2.style.display = "none";
        correct3.style.display = "none";
        correct4.style.display = "none";
      } else if(option == 2) {
        correct1.style.display = "none";
        correct2.style.display = "block";
        correct3.style.display = "none";
        correct4.style.display = "none";
      } else if(option == 3) {
        correct1.style.display = "none";
        correct2.style.display = "none";
        correct3.style.display = "block";
        correct4.style.display = "none";
      } else if(option == 4) {
        correct1.style.display = "none";
        correct2.style.display = "none";
        correct3.style.display = "none";
        correct4.style.display = "block";
      }
    }
  </script>
</body>
</html>
